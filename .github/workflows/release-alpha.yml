name: Manual trigger

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'Who to greet'
        default: 'World'

job1:
  name: Get working branch
  runs-on: [ubuntu-latest]
  outputs:
    extract_branch: ${{ steps.extract_branch.outputs.branch }}
  steps:
    - name: Branch used
      id: extract_branch
      run: |
        if [[ "${GITHUB_EVENT_NAME}" == "push" ]]; then
          echo "::set-output name=branch::$(echo ${GITHUB_REF##*/})"
        elif [[ "${GITHUB_EVENT_NAME}" == "pull_request" ]]; then
          echo "::set-output name=branch::$(echo $GITHUB_BASE_REF)"
        else
          echo "::set-output name=branch::INVALID_EVENT_BRANCH_UNKNOWN"
        fi

job2:
  needs: job1
  name: Release alpha version
  runs-on: ubuntu-latest
  env:
    BRANCH: ${{ needs.job1.outputs.extract_branch }}
  run: echo $BRANCH
  steps:
    - uses: gravity-ui/release-action@v1
      with:
        github-token: ${{ secrets.GRAVITY_UI_BOT_GITHUB_TOKEN }}
        npm-token: ${{ secrets.GRAVITY_UI_BOT_NPM_TOKEN }}
        node-version: 14
        npm-dist-tag: alpha
        default-branch: $BRANCH
